-- üì¶ StockProyectado ‚Äî Estimaci√≥n de stock futuro
--
-- Esta medida calcula el stock proyectado a partir de una fecha espec√≠fica,
-- sumando todas las entradas y restando todas las salidas **desde esa fecha en adelante**.

StockProyectado = 
CALCULATE(
    SUM(FactEntradas[Cantidad]) - SUM(FactSalidas[Cantidad]),
    FILTER(
        ALL(DimTiempo),
        DimTiempo[Fecha] >= MAX(DimTiempo[Fecha])
    )
)

-- üß† Explicaci√≥n paso a paso:
-- - SUM(FactEntradas[Cantidad]): suma las unidades entrantes
-- - SUM(FactSalidas[Cantidad]): suma las unidades salientes
-- - La diferencia representa el saldo neto de stock

-- - FILTER(ALL(DimTiempo), ...): ignora el contexto de fechas activo
--   y recalcula desde la fecha m√°xima visible en el gr√°fico hacia el futuro

-- - MAX(DimTiempo[Fecha]): representa la fecha actual del contexto visual
--   (por ejemplo, cada barra de un gr√°fico por semana)

-- ‚úÖ Ejemplo:
-- En un gr√°fico de l√≠neas por fecha:
-- - 2024-07-01 ‚Üí Stock proyectado = 150
-- - 2024-07-02 ‚Üí Stock proyectado = 135
-- - 2024-07-03 ‚Üí Stock proyectado = 120

-- ‚úÖ Cu√°ndo usar esta medida:
-- - En gr√°ficos de inventario acumulado o previsi√≥n de agotamiento
-- - Para detectar en qu√© punto el stock podr√≠a llegar a cero
-- - Como insumo para decisiones de reabastecimiento

-- üí° Consejo:
-- Puedes combinar esta medida con `IF([StockProyectado] < 0, "Riesgo", "OK")`
-- para crear alertas visuales o formatos condicionales en Power BI.
